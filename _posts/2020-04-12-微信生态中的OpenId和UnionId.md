---
layout: post
title:  "微信生态中的OpenId和UnionId"
date:   2020-04-12
categories:
    - 数据科学
tags:
    - 其他
---

在微信生态内，每个微信用户都有一个的WXID作为用户识别的唯一码。但是因为只要有了WXID就可以添加对方为好友，在微信生态内锁定这名用户。为了保护隐私，不能直接让开发者直接调用全局的WXID，否则我可以去各大头部小程序那里爬取用户WXID然后给他们推荐自己的小程序或公众号。这样整个生态是无法平衡共存的。

为了防止所有的小程序和公众号都用同一个WXID来识别用户，彻底杜绝这种大杂烩的局面。微信给每个小程序和公众号都分配了一个APPID，每一个APPID对应的会有一个APPSecret解密代码。利用APPID对WXID进行加密就得到了一个局部的用户ID，即OpenId。

> OpenId = WXID * APPID


正是因为这些OpenId只有使用该APPID对应的APPSecret才能解密得到WXID，所以各公众号和小程序就可以形成自己的私域流量。

OpenId的存在让各个公众号或小程序的流量被切割开了，每个公众号和小程序都是一个单独的小圈子，大家是互相隔离的孤岛。这样就会出现另一个问题，如果我有多个公众号和多个小程序需要共通，比如用户A进入公众号的页面和进入小程序的页面他的信息是相同的，该怎么解决呢？

这在公众号或者小程序的内部是没法解决的，这就需要引入第三方，即微信开放平台。也就是说我们需要把小程序和公众号关联在同一个账号下，这个就是微信开发平台的开发者账号。通过开发者账号ID对WXID进行加密得到一个同账号下不同账号公用的UnionId，这样只要我把相关的应用都关联到开放平台下，那么就可以分辨不同应用之间是否有同一个用户啦。

> UnionId = WXID * 开放平台开发者ID

