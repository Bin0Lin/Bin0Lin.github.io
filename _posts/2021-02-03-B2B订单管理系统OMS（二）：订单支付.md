---
layout: post
title:  "B2B订单管理系统OMS（二）：订单支付"
date:   2021-02-03
categories:
    - 业务认知
tags:
    - 订单系统
---

**提交订单后，订单的支付流程分为以下步骤**：

拆单——>定金支付——>生成合同——>上传回款——>回款审核

### 1. 拆单

因为不同的订单类型，后续的订单处理流程是不同的，所以不同的订单类型需要拆单；

相同的订单类型，供应商不同，订单处理中的对象也不同，所以不同的供应商需要拆单；

海外订单，不同的商品，由于供应商的备货周期可能存在差异，需要分开提货运输，那么海外同个供应商同种订单类型不同商品也需要拆单；

**基于以上业务需要，制定以下拆单规则**：

- 根据订单类型进行拆单；
- 根据供应商进行拆单；
- 判断是否是自营海外订单或联营海外订单，如果是，则根据商品进行拆单；

我们也曾经考虑过子母订单的模式，但由于子订单可能处于什么状态的都有，那母订单的状态就很难来表示，这种多层的状态机会显得很复杂、很混乱。最后索性就是直接拆成独立的订单，但是用一个批次号来标记同一次的订单，这样显示的时候可以用批次号来进行分组，达成子母订单的效果。

### 2. 定金支付

支付定金的操作只有在小程序下单的途径才会需要，主要目的是：

- 避免恶意下单；
- 增加客户的确定性；
- 锁定库存；

因为2B的款项支付都是走对公账户，需要财务来进行操作。定金的目的是让客户锁定库存，然后可以从容地走财务审批流程去付款，所以一般不会设的很高，我们默认是99，不会太高影响用户决策，也不会太低被恶意下单，然后在支付了首笔款后定金原路退回。

定金金额是按批次计算的，一个批次不管多少个订单都是99。然后将定金均分到每个订单里，当订单回款审核通过后自动退回定金。

因为只要提交了订单，就会对库存进行锁定。为了避免恶意占用库存，提交订单后定金支付是有时间限制的，我们目前设置的是半小时，半小时没有支付定金则订单自动取消，释放库存。

### 3. 生成合同

由于2B业务的特殊性，订单支付需要以下几个条件：

1. 支付之前需要签订销售合同；
2. 款项需要对公支付；
3. 对公支付的款项需要财务进行审核；

由于国际贸易业务的订单交付周期长，海外订单的账单会分为三笔款项进行支付，常规情况下是：

- 首笔款，在签订合同后支付订单总额的10%，用于订单履约；
- 次笔款，在即将出运时支付订单总额的40%，用于上游采购；
- 尾笔款，在即将到港时支付订单总额的50%，用户清关发货；

在途订单的账单会分为三笔款项进行支付，常规情况下是：

- 首笔款，在签订合同后支付订单总额的50%，用于订单履约；
- 尾笔款，在即将到港时支付订单总额的50%，用户清关发货；

现货订单的账单则最简单，在签订合同后就是直接回全款，然后发货；

不同的订单类型，商品交付的条件和期限各不相同，所以每种订单类型都会有独立的合同模板。把具体订单的信息填入对应的位置就可以快速生成合同。

为了方便客户，针对同一个客户同一类型的订单，在后台销售人员可以多选合成一个合同，然后寄给客户进行盖章留档。

### 4. 上传回款

客户收到合同后，走财务流程申请付款。财务付款成功后，将回执单发给客户，客户有两个途径上传回款。

- 通过小程序自助上传回款单；
- 发给对应的销售，销售在后台创建回款单；

回款单上需要以下信息：

- 客户名称
- 回款日期
- 回款渠道（支付宝、招商银行等）
- 回款金额
- 回款明细（关联的订单编号，每个订单的回款金额）
- 凭证附件

回款单创建后就会进入到财务审核流程。

### 5. 回款审核

回款单创建后会推送审核任务到财务工作页面，财务根据实际到账的金额和回款单信息进行人工核对，核对无误则点击通过，不一致则驳回修改。
