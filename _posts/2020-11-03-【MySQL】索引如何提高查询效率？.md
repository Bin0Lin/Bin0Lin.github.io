---
layout: post
title:  "【MySQL】索引如何提高查询效率？"
date:   2020-11-03
categories:
    - 数据科学
tags:
    - MySQL
---

由于业务上更多地设计了MySQL的查询，所以花了点时间了解了一下索引是怎么工作的，如何提高查询效率？    

磁盘的数据读取本质上是机械运动，需要寻道、寻点、拷贝到内存三个操作才能从磁盘里读取数据到内存中。寻道指磁臂移动到指定的磁道位置，大概需要5ms；寻点是在该磁道中找到对应的那个点，平均时间为转半圈的时间，假设为7200转/min的磁盘，寻点时间大约为4.17ms；拷贝操作相对前两个操作来说，时间可忽略不计。那么一次读取大约就是9ms。要想提高查询效率，就要尽量减少磁盘读取的次数。计算机本身已经做了一些优化，比如预读相邻数据到缓存。  

索引的存在也是这个目的，减少读取次数，提高查询效率。InnoDB存储引擎常用的索引是B-Tree和B+Tree，他们的基本原理和二分法差不多。二分法的查找时间为对数级Log2(N)，如果二叉搜索树的所有非叶子结点的左右子树的结点数目均保持差不多（平衡），那么B树的搜索性能逼近二分查找；它比连续内存空间的二分查找的优点是改变二叉搜索树结构（插入与删除结点）不需要移动大段的内存数据，甚至通常是常数开销；在使用搜索数的过程中尽量保持左右子节点的平衡，这样能最大提升搜索效率。所以，平衡查找树B-Tree就应运而生啦。  

B 树是为了磁盘或其它存储设备而设计的一种多叉平衡查找树。（相对于二叉，B树每个内结点有多个分支，即多叉）。每个节点有以下属性：  
- 关键字个数，即节点内有多少个关键字个数；  
- 关键字的值，即节点内所有关键字的值；  
- 是否叶子节点，布尔值；  
- 指向孩子节点的指针；没有孩子节点则为null。  

M阶B-Tree：  
- 除了根节点，每个节点最少有[m/2]-1个关键字，最多有（M-1）个关键字。  
- 关键字从左往右依次递增，最左边的最小，最右边的最大，不论层级。  

B+Tree是对B-Tree的改进，为了减少树的深度（搜索次数），尽量在叶子节点里多放一些关键字，B+Tree在非叶子节点指存储关键字和指针，不存储实际数据记录。  
- 所有关键字都出现在叶子结点的链表中（稠密索引），且链表中的关键字恰好是有序的；  
- 不可能在非叶子结点命中；  
- 非叶子结点相当于是叶子结点的索引（稀疏索引），叶子结点相当于是存储（关键字）数据的数据层；  
- 更适合文件索引系统；  
